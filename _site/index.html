<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Text To Speech</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
	 <table class="translations" style="width:100%"><tr class="translationshead"></tr></table> 
<script>
	// ID of the Google Spreadsheet
 var spreadsheetID = "1gsdlh7rZmZeC2rYBS16b3g1Z5kJ1AkiZRT9_sTJgBz4";

 // Make sure it is public or set to Anyone with link can view 
 var url = "https://spreadsheets.google.com/feeds/list/" + spreadsheetID + "/od6/public/values?alt=json";

 $.getJSON(url, function(data) {

  var entry = data.feed.entry;

  var langs = $(entry)[0].content.$t.split(", ");

  langs = langs.map(lang => (lang.split(":"))[0]);

  $( ".translationshead" ).append( "<th>nl</th>"); 

  langs.forEach(function(lang) {
     $( ".translationshead" ).append( "<th>"+lang+"</th>");
  });

  $(entry).each(function(index, element){
  	console.log(this);

  	var s = "<td>" + this.title.$t + "</td>";

  	this.content.$t.split(", ").forEach(function(el) {
  		text = (el.split(": "))[1];
  		lang = (el.split(": "))[0];
    	s += '<td> <a href="#" class="say">' + text + '<audio class="speech" rel="noreferrer" hidden></audio></a></td>';
    });

  	$( ".translations" ).append( "<tr>" + s + "</tr>" );
  	// console.log(this.title.$t);
  	// console.log(this.content.$t);

  });

 });

 // $(function(){
  $('a.say').on('click', function(e){
    console.log("clicked");
  })
 // });

  document.addEventListener('click', function (e) {
    if (hasClass(e.target, 'say')) {
        e.preventDefault();
        var targetElement = e.target || event.srcElement;
        var lang = "en";
        var text = encodeURIComponent($(targetElement).text());
        var url = "http://translate.google.com.vn/translate_tts?tl="+lang+"&q="+text+"&client=tw-ob";
        console.log(url);
        $(targetElement).find("audio:first").attr('src', url).get(0).play();
    } else if (hasClass(e.target, 'test')) {
        // .test clicked
        // Do your other thing
    }
}, false);

  function hasClass(elem, className) {
    return elem.className.split(' ').indexOf(className) > -1;
}
</script>

</body>