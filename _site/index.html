<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Text To Speech</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="main.css">
</head>

<body>
  <div class="container">
    <h1> Rozette </h1>
  	<table id="translations" class="translations" style="width:100%"><tr class="translationshead follow-scroll"></tr></table>
  </div>
<script src="https://code.responsivevoice.org/responsivevoice.js"></script>
<script>
  (function($) {
    var element = $('.follow-scroll'),
        originalY = element.offset().top;

    // Space between element and top of screen (when scrolling)
    var topMargin = 20;

    // Should probably be set in CSS; but here just for emphasis
    element.css('position', 'relative');

    $(window).on('scroll', function(event) {
        var scrollTop = $(window).scrollTop();

        element.stop(false, false).animate({
            top: scrollTop < originalY
                    ? 0
                    : scrollTop - originalY + topMargin
        }, 300);
    });
})(jQuery);
</script>
<script>
	// ID of the Google Spreadsheet
 var spreadsheetID = "1gsdlh7rZmZeC2rYBS16b3g1Z5kJ1AkiZRT9_sTJgBz4";

 // Make sure it is public or set to Anyone with link can view 
 var url = "https://spreadsheets.google.com/feeds/list/" + spreadsheetID + "/od6/public/values?alt=json";

 var voices = new Map();

 $.getJSON(url, function(data) {

  var entry = data.feed.entry;

  $( ".translationshead" ).append( "<th>Nederlands</th>"); 

  $(entry).each(function(index, element){
    if(voices.size == 0){
      this.content.$t.split(", ").forEach(function(el) {
        voices.set((el.split(": "))[0] ,(el.split(": "))[1]);
        $( ".translationshead" ).append( "<th>"+(el.split(": "))[1]+"</th>");
      });
    }
    else{
      var s = "<td>" + this.title.$t + "</td>";

      this.content.$t.split(", ").forEach(function(el) {
        text = (el.split(": "))[1];
        s += '<td> <a href="#"><i class="say fa fa-play-circle-o" style="font-size:48px;color:blue" lang="'+(el.split(": "))[0]+'" data-text="'+text+'"></i><audio class= rel="noreferrer" hidden></audio></a></td>';
      });

      $( ".translations" ).append( "<tr>" + s + "</tr>" );
      // console.log(this.title.$t);
      // console.log(this.content.$t);
    }
  });
 });

  // var voicelist = responsiveVoice.getVoices();
  // voicelist.forEach(function(voice){
  //   console.log('case "en": row[i] = "'+voice.name+'"; break;');
  // })

 // $(function(){
  // $('a.say').on('click', function(e){
  //   console.log("clicked");
  // })
 // });


  document.addEventListener('click', function (e) {
    if (hasClass(e.target, 'say')) {
        e.preventDefault();
        var targetElement = e.target || event.srcElement;
        $(targetElement).toggleClass("fa-play-circle-o fa-play-circle");
        var voice = $(targetElement).attr('lang');
        var text = $(targetElement).attr('data-text');
        responsiveVoice.speak(text, voices.get(voice), {onend: function(){
          $(targetElement).toggleClass("fa-play-circle fa-play-circle-o");
        }});

        // var text = encodeURIComponent($(targetElement).text());
        // var url = "http://translate.google.com/translate_tts?tl="+lang+"&q="+text+"&client=t";
        // console.log(url);
        // var referrer = "http://translate.google.com/";
        // $.ajax({
        //   type: 'GET',
        //   url: url,
        //   xhrFields: {
        //     withCredentials: false
        //   },
        //   headers: {
        //     'X-Alt-Referer': referrer, 
        //     'Access-Control-Allow-Origin': '*',
        //     'Access-Control-Allow-Origin': 'http://translate.google.com/',
        //     'Access-Control-Allow-Methods': "GET, OPTIONS",
        //     'Access-Control-Allow-Headers': "Authorization, X-Requested-With, Content-Type, Origin, Accept",
        //     'Access-Control-Allow-Credentials': "true"
        //   },
        //   success: function(data) {
        //     var audioElement = $(targetElement).find("audio:first");
        //     audioElement.attr('src', data);
        //     audioElement.get(0).load();
        //     audioElement.get(0).play();
        //   },
        //   error: function() {
        //   }
        // });
        // $(targetElement).find("audio:first").attr('src', url).get(0).play();
    } else if (hasClass(e.target, 'test')) {
        // .test clicked
        // Do your other thing
    }
}, false);

  function hasClass(elem, className) {
    return elem.className.split(' ').indexOf(className) > -1;
}
</script>

</body>