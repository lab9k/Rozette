<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rozette</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.css">
  <link rel="stylesheet" href="assets/css/owl.transitions.css">
  <link rel="stylesheet" href="assets/css/magnific-popup.css">
  <link rel="stylesheet" href="assets/css/apps.css">
  <link rel="stylesheet" href="assets/css/plyr.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/responsive.css">
  <link rel="stylesheet" href="css/main.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
</head>

<body class="page">

  <!-- Track List -->
  <div class="section tracks-section text-white">
    <div class="overlay section-padding">
      <div class="container">
        <div id="addSheet"><a href="help.html" class="btn btn-border btn-white"> Pas aan voor uw organisatie </a></div>
        <div class="row">
          <div class="col-md-8 col-md-offset-2 col-xs-12">
            <div class="section-header text-center">
              <h3 class="section-title">Rozette</h3>
              <p class="section-subtext">Translate to speech</p>
            </div>
          </div>
        </div>
        <div class="row">

          <div class="col-xs-12">
            <div class="music-wrap">
              <div class="row">
                <div class="col-md-4 col-sm-5 col-xs-6">
                  <div id="player-one" class="player-main-block">
                    <div class="album-art-block">
                      <div class="track-meta-info" id="meta-container">

                        <span class="song-name" amplitude-song-info="name" amplitude-main-song-info="true">Vertaling</span>
                      </div>

                      <div class="form-group">
                        <label for="sel1">Language:</label>
                        <select class="form-control" id="languages">
                          <option value="0">Selecteer taal...</option>                            
                        </select>
                      </div>


                      <div class="album-art-space">
                        <textarea id="text-say" rows="6" placeholder="Click op een term/zin" readonly></textarea>
                      </div>
                    </div>
                    
                  </div>
                </div>
                <div class="col-md-8 col-sm-7 col-xs-6">
                  <div id="searchfield" class="input-group stylish-input-group">
                    <input id="search" type="text" class="form-control" placeholder="Search">
                    <span class="input-group-addon">
                      <button type="submit">
                        <span class="fa fa-search"></span>
                      </button>
                    </span>
                  </div>
                  <div id="translations" class="player-track-list-block table-responsive-vertical">
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Track List End -->


  </div>

<footer style="display: block;">
  <div id="footer">
      <!-- Main -->
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-sm-6">
            <h4>About</h4>
            <p>Dit project voorziet een functionaliteit van translate to speech.</p>
          </div>
    
          <div class="col-md-4  col-sm-6">
            <h4>Helpful Links</h4>
            <ul class="footer-links">
              <li><a href="https://github.com/lab9k/Rozette">Github</a></li>
              <li><a href="./help.html">Help</a></li>
            </ul>
          </div>		
    
          <div class="col-md-3  col-sm-12">
            <h4>Made by</h4>
            <div class="text-widget">
                <a href="https://lab9k.github.io/" target="_blank"><img id="logolab9k" src="./images/logo_lab9k.svg"></a>
                <a href="https://digipolis.be" target="_blank"><img id="logodigipolis" src="./images/digipolis_white.png"></a>
            </div>
          </div>    
        </div>     
      </div>   
    </div>
  </footer>

  <!-- <body>
  <div id="addSheet">
    <a href="/getSheet.html"> Maak eigen Rozette pagina </a>
  </div>
  <div class="container">
    <h1> Rozette </h1>

    <div class="languages"></div>
    <br>

    <div class="row">
      <div class="col-md-8">
        <form>
          <input type="text" id="search" name="search" placeholder="Zoek">
        </form>
        <div class="table-responsive-vertical shadow-z-1">
        </div>
      </div>
      <div class="col-md-4">
        <div class="affix">
        </div>
      </div>
    </div>
  </div> -->
  <!-- <script>
  (function($) {
    var element = $('.follow-scroll'),
        originalY = element.offset().top;

    // Space between element and top of screen (when scrolling)
    var topMargin = 20;

    // Should probably be set in CSS; but here just for emphasis
    element.css('position', 'relative');

    $(window).on('scroll', function(event) {
        var scrollTop = $(window).scrollTop();

        element.stop(false, false).animate({
            top: scrollTop < originalY
                    ? 0
                    : scrollTop - originalY + topMargin
        }, 300);
    });
})(jQuery);
</script> -->
  <script>
    var currentLang = "en";
    var voices = new Map(); //map countrycode -> name of corresponding voice
    var translations = {};

    function getSheet(url) {
      $.getJSON(url, function (data) {

        var entry = data.feed.entry;

        // $( ".translationshead" ).append( "<th>Nederlands</th>"); 
        var i = 0;

        $(entry).each(function (index, element) {
          if (voices.size == 0) {
            //console.log(this.content.$t.split(", "));

            this.content.$t.split(", ").forEach(function (el) {
              voices.set((el.split(": "))[0], (el.split(": "))[1]);
              $("#languages").append("<option class='language' value=" + (el.split(": "))[0] + ">" + (el.split(": "))[0] + "</option>");

              //            $("#languages").append("<li><a href='' onclick='return false;'>"+(el.split(": "))[0])+"</a></li>";


              // $( ".translationshead" ).append( "<th>"+(el.split(": "))[1]+"</th>");
              //console.log((el.split(": "))[1]);
            });
          }
          else {


            var title = this.title.$t.replace(/[^ -~]+/g, "").replace(/(\r\n|\n|\r)/gm, "").trim();
            var s = '<div class="song amplitude-song-container amplitude-play-pause amplitude-active-song-container say"  data-say="' + title + '">';
            s += '<div class="song-meta-data">';
            s += '<span class="song-title">' + title + '</span>';
            s += '</div>';
            s += '<div class="play-now">';
            s += '<a class="btn btn-sm btn-black"><span class="normal-state" >Play</span><span class="play-state">Stop</span></a>';
            s += '</div>';
            translations[title] = {};
            //console.log(this.content.$t.split(", "));
            this.content.$t.split(", ").forEach(function (el) {
              translations[title][(el.split(": "))[0]] = (el.split(": "))[1];
              // text = (el.split(": "))[1];
              // s += '<td data-title="'+voices.get((el.split(": "))[0])+'"> <a href="#"><i class="say fa fa-play-circle" style="font-size:48px;color:black" lang="'+(el.split(": "))[0]+'" data-text="'+text+'" ></i><audio class= rel="noreferrer" hidden></audio></a></td>';
            });

            $("#translations").append(s);
            // console.log(this.title.$t);
            // console.log(this.content.$t);
          }
        });
      }).fail(function () {
        console.log("Loading spreadsheet failed.");
      });

    }

    window.onload = function (e) {
      var $rows = $('#translations').find('.song');
      $('#search').keyup(function () {
        $rows = $('#translations').find('.song');
        var val = '^(?=.*\\b' + $.trim($(this).val()).split(/\s+/).join('\\b)(?=.*\\b') + ').*$',
          reg = RegExp(val, 'i'),
          text;

        $rows.show().filter(function () {
          text = $(this).find(".song-meta-data").text().replace(/\s+/g, ' ');
          return !reg.test(text);
        }).hide();
      });
    }

    function querySt(ji) {
      hu = window.location.search.substring(1);
      gy = hu.split("&");

      for (i = 0; i < gy.length; i++) {
        ft = gy[i].split("=");
        if (ft[0] == ji) {
          return ft[1];
        }
      }
    }
    
  // ID of the Google Spreadsheet
  var defaultSheetID = "1gsdlh7rZmZeC2rYBS16b3g1Z5kJ1AkiZRT9_sTJgBz4"

    var spreadsheetID = defaultSheetID;

    var query = "undefined";
    var queries = ["sheet", "key"];
    var i = 0;
    queries.every(function (q) {
      query = decodeURIComponent(querySt(q));
      if (query != "undefined") {
        spreadsheetID = query;
        return false;
      }
      else {
        return true;
      }
    });

  // Make sure it is public or set to Anyone with link can view 
  var url = "https://spreadsheets.google.com/feeds/list/" + spreadsheetID + "/od6/public/values?alt=json";

  getSheet(url);
  

  // var voicelist = responsiveVoice.getVoices();
  // voicelist.forEach(function(voice){
  //   console.log('case "en": row[i] = "'+voice.name+'"; break;');
  // })

 // $(function(){
  // $('a.say').on('click', function(e){
  //   console.log("clicked");
  // })
 // });

var mouseflag = 0; //flag 0 if not click and drag, otherwise 1
var playflag = 0; //flag 0 if responsiveVoice is not playing
document.addEventListener("mousedown", function(){
    mouseflag = 0;
}, false);
document.addEventListener("mousemove", function(){
    mouseflag = 1;
}, false);
document.addEventListener('mouseup', function (e) {
  //responsiveVoice elements
  if(playflag === 1){
    e.preventDefault();
    let targetElement = e.target || event.srcElement;
    if (hasClass(e.target, 'amplitude-playing') || $(targetElement).parents('.amplitude-playing').length) {
      if($(targetElement).parents('.amplitude-playing').length){targetElement = $(targetElement).parents('.amplitude-playing');}
      $(targetElement).removeClass("amplitude-playing");
      $(targetElement).addClass("amplitude-paused");
      responsiveVoice.cancel();
      setTimeout(function(){ playflag = 0; }, 100);
    } else if (hasClass(e.target, 'say') || $(targetElement).parents('.say').length){
      let playingElement = $('.amplitude-playing');
      playingElement.removeClass("amplitude-playing");
      playingElement.addClass("amplitude-paused");
      playflag = 0;
    }
  } if(mouseflag === 0 && playflag === 0 ){
    e.preventDefault();
    let targetElement = e.target || event.srcElement;
    if (hasClass(e.target, 'say') || $(targetElement).parents('.say').length) {
      if ($(targetElement).parents('.say').length) {targetElement = $(targetElement).parents('.say');}
      playflag = 1;
      let text = $(targetElement).attr("data-say");
      let translation = translations[text][currentLang];
      $(targetElement).addClass("amplitude-playing");
      $(targetElement).removeClass("amplitude-paused");
      $('#text-say').val(translation);
      responsiveVoice.speak(translation, voices.get(currentLang), {onend: function(){
        $(targetElement).removeClass("amplitude-playing");
        $(targetElement).addClass("amplitude-paused");
        setTimeout(function(){ playflag = 0; }, 100);
      }});
    }
  } 

  //change language
  if (hasClass(e.target, 'language')) {
    e.preventDefault();
    let targetElement = e.target || event.srcElement;
    currentLang = $(targetElement).val();
    console.log(currentLang);
  }
}, false);

  function hasClass(elem, className) {
    return elem.className.split(' ').indexOf(className) > -1;
}
</script>
    <!-- Script -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/owl.carousel.js"></script>
    <script src="assets/js/imagesloaded.pkgd.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/plyr.js"></script>
    <script src="assets/js/jquery.ajaxchimp.min.js"></script>
    <script src="assets/js/isotope.pkgd.min.js"></script>
    <script src="assets/js/jquery.countdown.min.js"></script>
    <script src="assets/js/tether.min.js"></script>
    <script src="assets/js/jquery.slimscroll.min.js"></script>
    <script src="assets/js/amplitude.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmiJjq5DIg_K9fv6RE72OY__p9jz0YTMI"></script>
    <script src="js/map.js"></script>
    <script src="js/custom.js"></script>

</body>